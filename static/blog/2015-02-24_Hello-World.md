## Hello World

I've decided to create a blog - from scratch.

Unsatisified with bulky, hosted, blog platforms I've turned to [static webpage](http://en.wikipedia.org/wiki/Static_web_page) generation.

GitHub's [Jekyll](http://jekyllrb.com) project seems interesting but I'm not as familiar with [Ruby](https://www.ruby-lang.org) as I am [Python](https://www.python.org). 

[Pelican](http://blog.getpelican.com) seems to be popular but I'm not particular about its code. [Hyde](http://hyde.github.io) looks wonderful though extensive. I enjoy simplicity and understanding of my code.

So, I decided to create a platform of my own - implementing elements familiar to me. This blog will chronicle its development from inception to everyday use.

I've dubbed this application _"**Noise** - a static webpage generator._

#### Source Code

While this platform will be built to serve my purposes, it will be developed in a modular fashion so as to be utilized in other personal projects, or by others.

All source code for the application may be found at my [Github repository](https://github.com/ryonsherman/noise). Feel free to [fork](https://help.github.com/articles/fork-a-repo) or make [pull requests](https://help.github.com/articles/using-pull-requests).

Additionally, the code behind this blog (generated by **Noise**) is available [here](https://github.com/ryonsherman/ryonsherman.github.io).

### Humble Beginnings

To begin, we'll need a starting point. I'll review some general ideas.

Some functionality for the application includes:

 * Console-based input
 * Static HTML generation
 * Static resource support

More advanced functionality includes:

 * [Flask](http://flask.pocoo.org) style [routes](http://flask.pocoo.org/docs/0.10/api/#url-route-registrations)
 * [Jinja](http://jinja.pocoo.org) template engine
 * [Markdown](http://daringfireball.net/projects/markdown) content support

Please note that the following code are merely snippets inteded for demonstration.

#### Parsing Arguments

A console application is created to accept arguments.

```python
import argparse

# initialize argument parser
parser = argparse.ArgumentParser(prog='noise',
    description="noise: a static webpage generator")
# include default 'version' mechanic
parser.add_argument('--version', action='version',
    version="%(prog)s {}".format(__version__))

# parse arguments
args = parser.parse_args()
```

This provides the following console interaction:

```
$ ./noise.py --help

usage: noise [-h] [--version]

noise: a static webpage generator

optional arguments:
  -h, --help  show this help message and exit
  --version   show program's version number and exit
```

Next, we'll need to provide actions for our application to perform.

##### Application Actions

The application will initially perform two basic actions:

 * `init` - Initialize the project directory
 * `build` - Generate static files
 
Future support for `publish` will be provided with the intention of uploading the generated files to a target location.

For this, we'll create a sub-parser and add parsers for each action:

```python
# create 'action' subparsers
subparsers = parser.add_subparsers(dest='action',
    help="action to perform")
# create 'init' action subparser
init_parser = subparsers.add_parser('init',
    help="initialize project directory")
# create 'build' action subparser
build_parser = subparsers.add_parser('build',
    help="build project")
```

This now provides the following console interaction:

 
```
$ ./noise.py --help

usage: noise [-h] [--version] {init,build} ...

noise: a static webpage generator

positional arguments:
  {init,build}  action to perform
    init        initialize project directory
    build       build project
```

##### Project Path

In order to target a project, we'll need to pass its directory path to these actions:

```python
# add project 'path' argument to action subparsers
for p in (init_parser, build_parser):
    p.add_argument('path', help="project directory path")
```

Support for initializing/building the current working directory may be support but we'll address that later.

The console interaction for the init/build action now reads:

```
$ ./noise.py init --help

usage: noise init [-h] path

positional arguments:
  path        project directory path
```

###### Path Helper

Due to the extensive filesystem use of this application, a [`Path`] helper is created to aid in the handling of these paths. Its development can be followed in a [supplimental post](#).

The module can be found [here][`Path`] and provides the following functionality:

```python
$ python

>>> from path import Path
>>> path = Path('/tmp')
>>> print path
/tmp
>>> print path('foo.txt')
/tmp/foo.txt
>>> print path.paths
('build', 'static', 'template')
>>> print path.build('bar.txt')
/tmp/build/bar.txt
```

##### Application Initialization

We'll create two placeholder methods to emulate the init/build actions:

```python
from path import Path

class Noise(object):
    def __init__(self, path):
        # initialize project path helper
        self.path = Path(path)

    def init(self):
        print "Initializing project '%s'" % self.path

    def build(self):
        print "Building project '%s'" % self.path
...

def main():
    ...
    
    # initialize project
    if args.action == 'init':
        Noise(args.path).init()
    # build project
    if args.action == 'build':
        Noise(args.path).build()
```

The path helper has an [`init()`] method to handle the creation of project directories.

```python
class Noise(object):
	...
    def init(self):
        # initialize paths
        self.path.init()
```

Calling this upon application initialization produces the directory tree:

```
$ ./noise.py init blog

blog
├── build
├── static
└── template
```

###### Project Boilerplate

Projects are actually Python modules themselves. As mentioned, [Flask](http://flask.pocoo.org) style [routes](http://flask.pocoo.org/docs/0.10/api/#url-route-registrations) are used to manipulate the generation of files intended to serve a given URL.

A `Route` is a method, to which the `Page` object is passed. It exposes data used when rendering the page. 

For example, a project's `__init__.py` file may contain the following `index.html` route:

```python
from noise import Noise

app = Noise(__file__)

@app.route('/')
def index(page):
    # set template variables
    page.data.update({
        'title': "Noise - a static webpage generator",
        'body':  "Hello World!"
    })
```

Once again, a helper is created to aid in handling these routes. Its development can be followed in a [supplimental post](#) and its module may be found [here](#).

In order to initialize a project as a module, this boilerplate is written to its directory:

```python
class Noise(object):
    ...
    def init(self):
        ...
        # create project init file
        path = self.path('__init__.py')
        if not os.path.exists(path):
            from noise.route import BOILERPLATE
            with open(path, 'w') as f: 
                f.write(BOILERPLATE)
```

The directory structure now reads:

```
blog
├── build
├── __init__.py
├── static
└── template
```

##### Building the Project

The project module is imported its application [`build()`] method is called:

```python
def main():
    ...
    # initialize project
    if args.action == 'init':
        Noise(args.path).init()
    # import and build project
    elif args.action == 'build':
        sys.path.insert(0, os.path.dirname(args.path))
        __import__(args.path).app.build()
```

The build method handles static resources and rendering pages.

###### Handling Static Resources

Static resources are copied from the static directory to the build directory:

```python
class Noise(object):
    ...
    def build(self):
        # clear build directory
        build_path = str(self.path.build)
        if os.path.exists(build_path):
            shutil.rmtree(build_path)
            
        # copy static contents to build path
        static_path = str(self.path.static)
        if os.path.exists(static_path):
            shutil.copytree(static_path, build_path)
            
        # recreate build directory
        else: os.mkdir(build_path)
```

###### Rendering Pages

The [`Page`] object handles rendering file to the build directory. Its development can be followed in a [supplimental post](#) and its module may be found [here](#).

The '[`route`]' [decorator](https://www.python.org/dev/peps/pep-0318) adds the callback methods defined in the project initialization file to a list of the application's routes. The [`build()`] method then creates [`Page`] objects for these routes and performs said callback:

```python
from noise.page import Page

class Noise(object):
    ...
    def build(self):
        ...
        # iterate routes
        for route, page in self.routes.items():
            # build page if callback passed
            if type(page) is not Page:
                # save callback
                callback = page
                # initialize page object
                page = Page(self, route)
                # perform callback on page
                callback(page)
            # render page
            page.render()
```

`Page` objects themselves may also be added to applications routes. This will allow future plugins to create routes in a more dynamic fashion.

### Test Drive

Now that we've covered the [`Path`], [`Route`], [`Page`], and the [`Noise`] application itself, we're ready create our initial build:

```
$ ./noise.py build blog

blog
├── build
│   └── index.html
├── __init__.py
├── static
└── template
```

A browser directed to `file:///.../blog/build/index.html` displays 'Hello World!' - success!

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>noise: a static website generator</title>
  </head>
  <body>
    Hello World!
  </body>
</html>
```

Onward to more features!

[`Path`]: https://github.com/ryonsherman/noise/blob/d27dbee9e46a2168100a9e5df4f7ce0a99fed83b/src/noise/path.py
[`Route`]: https://github.com/ryonsherman/noise/blob/d27dbee9e46a2168100a9e5df4f7ce0a99fed83b/src/noise/route.py
[`Page`]: https://github.com/ryonsherman/noise/blob/d27dbee9e46a2168100a9e5df4f7ce0a99fed83b/src/noise/page.py
[`Noise`]: https://github.com/ryonsherman/noise/blob/d27dbee9e46a2168100a9e5df4f7ce0a99fed83b/src/noise/__init__.py

[`route`]: https://github.com/ryonsherman/noise/blob/d27dbee9e46a2168100a9e5df4f7ce0a99fed83b/src/noise/route.py#L44
[`init()`]: https://github.com/ryonsherman/noise/blob/d27dbee9e46a2168100a9e5df4f7ce0a99fed83b/src/noise/path.py#L51
[`build()`]: https://github.com/ryonsherman/noise/blob/d27dbee9e46a2168100a9e5df4f7ce0a99fed83b/src/noise/__init__.py#L42
